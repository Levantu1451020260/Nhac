  <!doctype html>
  <html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Source Code T·ªè T√¨nh C·ª±c Ng·∫ßu</title>
    <style>
      *{box-sizing:border-box;margin:0;padding:0}
      html,body{height:100%}
      body{
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', monospace;
        background: radial-gradient(ellipse at 10% 10%, #0b1220 0%, #02060a 40%), linear-gradient(180deg,#071123 0,#02060a 100%);
        color:#dbe9ff;
        display:flex;align-items:center;justify-content:center;min-height:100vh;padding:1rem;
      }
      .card{
        width:min(980px,96%);
        background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
        border:1px solid rgba(255,255,255,0.04);
        border-radius:16px;padding:10px;box-shadow:0 10px 40px rgba(2,6,10,0.75), inset 0 -60px 120px rgba(255,255,255,0.01);
        position:relative;overflow:hidden;
      }
      .header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
      .dot{width:12px;height:12px;border-radius:50%;background:#ff6b6b;box-shadow:0 0 8px #ff6b6b}
      .title{font-weight:700;font-size:14px;letter-spacing:0.6px;color:#e6f0ff}
      .subtitle{color:#9fb6d9;font-size:12px;margin-left:auto}
      .terminal{
        background:linear-gradient(180deg, rgba(5,13,25,0.6), rgba(2,6,10,0.6));
        border-radius:12px;padding:10px;min-height:140px;border:1px solid rgba(255,255,255,0.03);
        overflow:hidden;position:relative;
      }
      .code{
        white-space:pre-wrap;font-size:12px;line-height:1.5;color:#b9e2ff;min-height:100px;
      }
      .cursor{display:inline-block;width:10px;height:18px;background:#7be3ff;margin-left:4px;vertical-align:text-bottom;animation:blink 1s steps(2) infinite}
      @keyframes blink{50%{opacity:0}}
      .big-message{
        position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;pointer-events:none;opacity:0;transform:scale(0.9);transition:all .45s cubic-bezier(.2,.9,.2,1);
        background-color: #000;
      }
      .big-message.show{opacity:1;transform:scale(1);pointer-events:auto}
      .big-message h1{font-size:18px;color:#ffdee6;margin-bottom:8px;text-shadow:0 6px 24px rgba(255,120,160,0.15),0 0 28px rgba(255,70,130,0.15)}
      .big-message p{color:#ffdbe8;margin-bottom:14px;font-size:13px;}
      .actions{display:flex;gap:8px}
      .btn{
        appearance:none;border:0;padding:8px 12px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.4);transform:translateY(0);transition:all .18s ease;color:#021224;
        font-size:13px;
      }
      .btn:active{transform:translateY(2px)}
      .accept{background:linear-gradient(90deg,#ff9db8,#ff6b9e);}
      .decline{background:linear-gradient(90deg,#9fbce3,#6b9fff);}
      canvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}
      .hint{font-size:11px;color:#93b2d6;margin-top:10px}
      .confetti{position:absolute;width:10px;height:14px;opacity:0.95;border-radius:2px;transform:translateY(-50px) rotate(0);will-change:transform,opacity}
      .glitch {
        position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen;opacity:0;transition:opacity .15s linear;
      }
      .glitch.show{opacity:1;}
      .glitch::before,.glitch::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg, rgba(255,0,80,0.05), transparent);mix-blend-mode:screen;animation:glitch 250ms infinite}
      @keyframes glitch{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-2px)}100%{transform:translateX(0)}}

      /* Dialog styles */
      .dialog-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.65);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .dialog-overlay.show { display: flex; }
      .dialog-box {
        background: #0b1220;
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 14px;
        padding: 14px;
        width: min(95vw, 340px);
        box-shadow: 0 8px 40px rgba(0,0,0,0.5);
        color: #fff;
        animation: popup 0.3s ease;
      }
      @keyframes popup {
        from {transform: scale(0.8); opacity: 0;}
        to {transform: scale(1); opacity: 1;}
      }
      .dialog-box h2 {
        margin-bottom: 10px;
        font-size: 16px;
        text-align: center;
      }
      .dialog-box textarea {
        width: 100%;
        min-height: 70px;
        background: rgba(255,255,255,0.07);
        border: none;
        outline: none;
        color: #fff;
        padding: 8px;
        border-radius: 8px;
        resize: none;
        margin-bottom: 10px;
        font-family: inherit;
        font-size: 13px;
      }
      .dialog-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }
      .dialog-actions button {
        padding: 7px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        font-size: 13px;
      }
      #cancelDialog {
        background: #6b9fff;
        color: #021224;
      }
      #submitReason {
        background: #ff6b9e;
        color: #021224;
      }

      /* Responsive - mobile first */
      @media (min-width: 400px) {
        .card { padding: 12px; }
        .big-message h1 { font-size: 20px; }
        .title { font-size: 13px; }
        .terminal { padding: 12px; min-height: 120px; }
        .code { font-size: 13px; }
      }
      @media (min-width: 560px) {
        .card { padding: 18px; }
        .big-message h1 { font-size: 28px; }
        .title { font-size: 14px; }
        .terminal { padding: 16px; min-height: 180px; }
        .code { font-size: 14px; }
      }
      @media (min-width: 700px) {
        .card { padding: 24px; }
        .big-message h1 { font-size: 32px; }
        .title { font-size: 16px; }
        .terminal { padding: 18px; min-height: 220px; }
        .code { font-size: 15px; }
      }
      @media (min-width: 900px) {
        .card { padding: 32px; }
        .big-message h1 { font-size: 44px; }
        .title { font-size: 18px; }
        .terminal { padding: 24px; min-height: 260px; }
        .code { font-size: 16px; }
      }
    </style>
  </head>
  <body>
    <div class="card" id="card">
      <div class="header">
        <div style="display:flex;gap:6px;align-items:center">
          <div class="dot"></div>
          <div class="dot" style="background:#ffd36b;box-shadow:0 0 8px #ffd36b"></div>
          <div class="dot" style="background:#7be3ff;box-shadow:0 0 8px #7be3ff"></div>
        </div>
        <!-- <div class="title">Source Code ‚Äî T·ªè T√¨nh C·ª±c Ng·∫ßu</div> -->
        <div class="subtitle">Ch·∫°y t·ª´ng d√≤ng, b·∫•m ƒë·ªÉ hi·ªán l·ªùi t·ªè t√¨nh</div>
      </div>
      <div class="terminal">
        <div class="code" id="code"></div>
        <div class="big-message" id="big">
          <h1>Em c√≥ ƒë·ªìng √Ω kh√¥ng?</h1>
          <p>Em cho anh m·ªôt c√¢u h·ªôi nh√© !!!‚ù§Ô∏è</p>
          <div class="actions">
            <button class="btn accept" id="accept">Ch·∫•p nh·∫≠n üíñ</button>
            <button class="btn decline" id="decline">T·ª´ ch·ªëi üò¢</button>
          </div>
        </div>
        <canvas id="hearts"></canvas>
        <div class="glitch" id="glitch"></div>
      </div>
      <div class="hint">M·∫πo: b·∫•m 'Ch·∫•p nh·∫≠n' ƒë·ªÉ xem animation.</div>
      <div class="dialog-overlay" id="dialogOverlay">
        <div class="dialog-box">
          <h2>L√Ω do t·ª´ ch·ªëi üíî</h2>
          <textarea id="reasonInput" placeholder="Nh·∫≠p l√Ω do..."></textarea>
          <div class="dialog-actions">
            <button id="cancelDialog">H·ªßy</button>
            <button id="submitReason">G·ª≠i</button>
          </div>
        </div>
      </div>
    </div>
    <audio id="bgMusic" src="Chamem.mp3"></audio>
    <script>
      // DOM elements
      const codeEl = document.getElementById('code');
      const big = document.getElementById('big');
      const acceptBtn = document.getElementById('accept');
      const declineBtn = document.getElementById('decline');
      const canvas = document.getElementById('hearts');
      const glitch = document.getElementById('glitch');
      const card = document.getElementById('card');

      // Lines of "source code"
      const lines = [
        "// file: will_you_compile_with_me.js",
        "const me = {",
        "  name: 'Th√πy An ü•∞ü•∞',",
        "  feelings: 'Y√™u c·ª±c k√¨ nhi·ªÅu',",
        "  bravery: 100",
        "};",
        "",
        "function reveal() {",
        "  // ƒê·ªçc k·ªπ: ƒë√¢y l√† ph·∫ßn quan tr·ªçng",
        "  console.log('L·ªùi mu·ªën n√≥i t·ª´ s√¢u b√™n trong",
        "               l√≤ng a mu·ªën g·ª≠i t·ªõi cho e !!!');",
        "}",
        "",
        "if (me.bravery > 50) {",
        "  reveal();",
        " // OUTPUT: M·ªôt l·ªùi t·ªè t√¨nh",
        " // > B√© √†! B√© ∆°i! C√≥ l·∫Ω nh·ªØng l·ªùi a s·∫Øp n√≥i",
        " // ra ƒë√¢y l√† t·∫•t c·∫£ nh·ªØng g√¨ xu·∫•t ph√°t t·ª´",
        " // t·∫≠n ƒë√°y l√≤ng a.",
        " ",
        " // T·ª´ l·∫ßn ƒë·∫ßu ti√™n nh√¨n th·∫•y e, a ƒë√£ r·ª•t r√®,",
        " // n√© tr√°nh. Nh∆∞ng kh√¥ng ph·∫£i v√¨ gh√©t b·ªè hay",
        " // c√≥ √Ω g√¨ ƒë√¢u, ch·ªâ l√† khi ·∫•y a nghƒ© r·∫±ng e",
        " // ƒë√£ c√≥ ng∆∞·ªùi th∆∞∆°ng, ho·∫∑c e ƒë√£ c√≥ ng∆∞·ªùi ƒë·ªÉ",
        " // m·∫Øt ƒë·∫øn e r·ªìi.",
        " ",
        " // Nh·ªØng l·∫ßn e n√≥i y√™u a, a c·ª© ng·ª° ƒë√≥ ch·ªâ",
        " // l√† m·ªôt c√¢u n√≥i ƒë√πa ƒë·ªÉ khi·∫øn ng∆∞·ªùi ƒë√≥ ghen",
        " // t·ªã .ƒê·∫øn khi bi·∫øt ƒë∆∞·ª£c s·ª± th·∫≠t, a ƒë√£ tr√°ch",
        " // b·∫£n th√¢n nhi·ªÅu l·∫ßn: sao kh√¥ng nh·∫≠n ra",
        " // s·ªõm h∆°n ƒë·ªÉ c√≥ th√™m th·ªùi gian g·∫ßn g≈©i",
        " // b√™n e nhi·ªÅu h∆°n? ƒê·ªÉ gi·ªù ƒë√¢y ph·∫£i ti·∫øc",
        " // nu·ªëi qu√£ng th·ªùi gian qu√Ω gi√° ·∫•y. üòû",
        " ",
        " // A c≈©ng kh√¥ng bi·∫øt v√¨ sao tr√°i tim l·∫°i",
        " // th·∫´n th·ªù ƒë·ªÉ r·ªìi iu e d·∫øn nh∆∞ n√†y.",
        " // L√† v√¨ e xinh h∆°n m·ªôt b√¥ng hoa?",
        " // Hay v√¨ t√≠nh t√¨nh vui v·∫ª, h√≤a ƒë·ªìng?",
        " // Hay v√¨ d√°ng v·∫ª nh·ªè nh·∫Øn ƒë√°ng y√™u?",
        " // A ch·∫≥ng th·ªÉ bi·∫øt n·ªØa. ƒê√∫ng l√† a ng·ªëc th·∫≠t,",
        " // y√™u e m√† kh√¥ng bi·∫øt v√¨ l√Ω do g√¨ ü§£ü§£.",
        " ",
        " // A bi·∫øt r·∫±ng cu·ªôc ƒë·ªùi ph·∫£i tr·∫£i qua nhi·ªÅu",
        " // n·ªói ƒëau m·ªõi tr∆∞·ªüng th√†nh. Nh∆∞ng gi·ªù ƒë√¢y",
        " // a ch·∫≥ng bi·∫øt b·∫£n th√¢n mang th√¢n ph·∫≠n g√¨",
        " // m√† c·ª© m√£i nh·ªõ v·ªÅ e.",
        " ",
        " // A ch·ªâ l√† m·ªôt th·∫±ng coder kh√¥ khan, ƒë√¥i khi",
        " // nh·∫°t nh·∫Ωo v√† thi·∫øu tinh t·∫ø. Nh∆∞ng a h·ª©a",
        " // s·∫Ω c·ªë g·∫Øng thay ƒë·ªïi m·ªói ng√†y: u·ªëng th·∫≠t",
        " // nhi·ªÅu n∆∞·ªõc m·∫Øm, ƒÉn th·∫≠t nhi·ªÅu mu·ªëi ƒë·ªÉ",
        " // tr·ªü n√™n m·∫∑n m√† h∆°n, ƒë·ªÉ m·ªói ng√†y b√™n e",
        " // ƒë·ªÅu l√† m·ªôt ng√†y vui, m·ªôt ng√†y h·∫°nh ph√∫c ü§£ü§£.",
        " ",
        " // Th√¥i kh·ªï qu√°, ch·∫Øc a h·∫øt vƒÉn r·ªìi‚Ä¶ ƒë·ªÉ a",
        " // ng·∫Øt b√∫t ·ªü ƒë√¢y nh√©!",
        "  //üòÅüòÅüòÅüòÅ",
        "// L·ªùi cu·ªëi Anh ch·ªâ mu·ªën n√≥i r·∫±ng ",
        "// Anh Y√™u Em",
        "// L√†m Ng∆∞·ªùi Y√™u Anh Nha B√©",
      "}",
      "",
        "// Nh·∫•n ƒë·ªÉ hi·ªán ph·∫ßn quan tr·ªçng...",
      ];

      // Typewriter effect
      async function typeLines() {
        for (let i = 0; i < lines.length; i++) {
          await typeLine(lines[i] + '\n');
        }
        const cursor = document.createElement('span');
        cursor.className = 'cursor';
        codeEl.appendChild(cursor);
        await sleep(900);
        cursor.remove();
        // big.classList.add('show');
      }
      function typeLine(text){
        return new Promise((res) => {
          let idx = 0;
          const span = document.createElement('span');
          codeEl.appendChild(span);
          const t = setInterval(()=>{
            span.textContent += text[idx] === ' ' ? '\u00A0' : text[idx];
            idx++;
            codeEl.scrollTop = codeEl.scrollHeight;
            if (idx >= text.length) { clearInterval(t); setTimeout(res, 120); }
          }, 28);
        });
      }
      function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

      // Heart canvas
      function fitCanvas(){
        canvas.width = canvas.clientWidth * devicePixelRatio;
        canvas.height = canvas.clientHeight * devicePixelRatio;
        ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
      }
      const ctx = canvas.getContext('2d');
      let hearts = [];
      function spawnHeart(x,y){
        hearts.push({x,y,vx:(Math.random()-0.5)*2,vy:-1.6- Math.random()*1.2,life:60+Math.random()*40,scale:0.9+Math.random()*0.6,rot:Math.random()*Math.PI*2});
      }
      function drawHeartPath(x,y,s){
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.bezierCurveTo(x, y-3*s, x-5*s, y-15*s, x-25*s, y-15*s);
        ctx.bezierCurveTo(x-55*s, y-15*s, x-55*s, y+22*s, x-55*s, y+22*s);
        ctx.bezierCurveTo(x-55*s, y+40*s, x-35*s, y+62*s, x, y+78*s);
        ctx.bezierCurveTo(x+35*s, y+62*s, x+55*s, y+40*s, x+55*s, y+22*s);
        ctx.bezierCurveTo(x+55*s, y+22*s, x+55*s, y-15*s, x+25*s, y-15*s);
        ctx.bezierCurveTo(x+10*s, y-15*s, x, y-3*s, x, y);
        ctx.closePath();
      }
      function animate(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for (let i=hearts.length-1;i>=0;i--){
          const h=hearts[i];
          h.x += h.vx;
          h.y += h.vy;
          h.vy += 0.06;
          h.life -= 1;
          h.rot += 0.05;
          const alpha = Math.max(0, h.life/100);
          ctx.save();
          ctx.translate(h.x, h.y);
          ctx.rotate(h.rot);
          ctx.scale(h.scale*0.6, h.scale*0.6);
          ctx.globalAlpha = alpha;
          const grad = ctx.createLinearGradient(-25, -20, 25, 80);
          grad.addColorStop(0, 'rgba(255,120,160,0.95)');
          grad.addColorStop(1, 'rgba(255,200,220,0.9)');
          ctx.fillStyle = grad;
          drawHeartPath(0,0,0.3);
          ctx.fill();
          ctx.restore();
          if (h.life <= 0) hearts.splice(i,1);
        }
        requestAnimationFrame(animate);
      }

      // Confetti
      function makeConfetti(x,y){
        const colors = ['#ff6b9e','#ffd36b','#7be3ff','#9fbce3','#c7ffb5'];
        for(let i=0;i<30;i++){
          const el = document.createElement('div');
          el.className = 'confetti';
          el.style.left = (x + (Math.random()-0.5)*120) + 'px';
          el.style.top = (y + (Math.random()-0.5)*40) + 'px';
          el.style.background = colors[Math.floor(Math.random()*colors.length)];
          el.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
          document.body.appendChild(el);
          const dx = (Math.random()-0.5)*200;
          const dy = 600 + Math.random()*300;
          const rot = (Math.random()-0.5)*720;
          el.animate([
            {transform:`translateY(0px) rotate(${Math.random()*360}deg)`, opacity:1},
            {transform:`translate(${dx}px, ${dy}px) rotate(${rot}deg)`, opacity:0.2}
          ],{duration:1200+Math.random()*800,easing:'cubic-bezier(.2,.9,.2,1)'}).onfinish = ()=>el.remove();
        }
      }

      // Accept handler
      // acceptBtn.addEventListener('click', (e)=>{
      //   const rect = acceptBtn.getBoundingClientRect();
      //   const cx = rect.left + rect.width/2 - card.getBoundingClientRect().left;
      //   const cy = rect.top + rect.height/2 - card.getBoundingClientRect().top;
      //   for(let i=0;i<18;i++) spawnHeart(cx + (Math.random()-0.5)*80, cy + (Math.random()-0.5)*40);
      //   makeConfetti(rect.left + rect.width/2, rect.top + rect.height/2);
      //   big.querySelector('h1').textContent = 'Tuy·ªát v·ªùi! üíñ';
      //   big.querySelector('p').textContent = 'B·∫Øt ƒë·∫ßu vi·∫øt ti·∫øp ch∆∞∆°ng tr√¨nh ƒë·ªùi nhau nh√©.';
      //   acceptBtn.disabled = true;
      //   acceptBtn.textContent = 'ƒê√£ ch·∫•p nh·∫≠n ‚úì';
      // });
      const music = document.getElementById('bgMusic');

      acceptBtn.addEventListener('click', () => {
        big.querySelector('h1').textContent = 'Tuy·ªát v·ªùi! üíñ';
        big.querySelector('p').textContent = 'A ƒë√£ bi·∫øt ƒë√°p √°n r·ªìi üòä';
        acceptBtn.disabled = true;
        acceptBtn.textContent = 'ƒê√£ ch·∫•p nh·∫≠n ‚úì';
        declineBtn.style.display = 'none';
        
        // Ph√°t nh·∫°c
        music.play();
      });

      // Decline handler
      // declineBtn.addEventListener('click', ()=>{
      //   glitch.classList.add('show');
      //   big.querySelector('h1').textContent = '√îi... üò¢';
      //   big.querySelector('p').textContent = 'Kh√¥ng sao, tr√°i tim v·∫´n ƒë·∫≠p m·∫°nh nh∆∞ tr∆∞·ªõc.';
      //   declineBtn.disabled = true;
      //   declineBtn.textContent = 'ƒê√£ t·ª´ ch·ªëi';
      //   hearts = [];
      //   setTimeout(()=>glitch.classList.remove('show'), 1400);
      // });
      const dialogOverlay = document.getElementById('dialogOverlay');
      const reasonInput = document.getElementById('reasonInput');
      const cancelDialog = document.getElementById('cancelDialog');
      const submitReason = document.getElementById('submitReason');

      // Khi nh·∫•n n√∫t T·ª´ ch·ªëi -> m·ªü dialog
      declineBtn.addEventListener('click', () => {
        dialogOverlay.classList.add('show');
        reasonInput.value = ''; // reset n·ªôi dung
      });

      // ƒê√≥ng dialog
      cancelDialog.addEventListener('click', () => {
        dialogOverlay.classList.remove('show');
      });

      // G·ª≠i l√Ω do
      submitReason.addEventListener('click', () => {
        const reason = reasonInput.value.trim() || "Kh√¥ng c√≥ l√Ω do";
        dialogOverlay.classList.remove('show');

        glitch.classList.add('show');
        big.querySelector('h1').textContent = '√îi... üò¢';
        big.querySelector('p').textContent = 'Kh√¥ng sao, a ƒë√£ bi·∫øt ƒë√°p √°n r·ªìi. üòä';
        declineBtn.disabled = true;
        declineBtn.textContent = 'ƒê√£ t·ª´ ch·ªëi';
        hearts = [];
        setTimeout(() => glitch.classList.remove('show'), 1400);
acceptBtn.style.display = 'none';
        // G·ª≠i d·ªØ li·ªáu v·ªÅ Google Script
        sendResponse({
          button: "ƒê√£ t·ª´ ch·ªëi",
          reason: reason
        });
      });
      // Typing, canvas, and events
      window.addEventListener('resize', fitCanvas);
      fitCanvas();
      animate();
      typeLines();
      codeEl.addEventListener('click', ()=>{ big.classList.add('show'); });
      window.addEventListener('keydown', (e)=>{
        if (e.key.toLowerCase() === 'y') acceptBtn.click();
        if (e.key.toLowerCase() === 'n') declineBtn.click();
      });
      setInterval(()=>{
        const w = canvas.clientWidth; const h = canvas.clientHeight;
        spawnHeart(Math.random()*w, h - 30);
      }, 900);

      // Send response to Google Script
      function sendResponse(answer) {
        fetch('https://script.google.com/macros/s/AKfycbwAbzzeyTN5PH2Vp0_Anva7l4nJLMZ9TVzkrHJPxH4D343sNmHotiIXnEQSBllvYZUr6Q/exec', {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            response: answer,
            time: new Date().toISOString()
          })
        });
      }
      acceptBtn.addEventListener('click', function() {
        sendResponse(acceptBtn.textContent.trim());
      });
      declineBtn.addEventListener('click', function() {
        sendResponse(declineBtn.textContent.trim());
      });
    </script>
  </body>
  </html>
